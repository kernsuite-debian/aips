      SUBROUTINE Q1GRD (UV, VIS, WT, L, G, CX, CY, NT2, M,
     *   LROW, CNT, NFREQ)
C-----------------------------------------------------------------------
C! Subroutine call version of VFC routine; replaced by vector version.
C# Obselete
C-----------------------------------------------------------------------
C;  Copyright (C) 1995
C;  Associated Universities, Inc. Washington DC, USA.
C;
C;  This program is free software; you can redistribute it and/or
C;  modify it under the terms of the GNU General Public License as
C;  published by the Free Software Foundation; either version 2 of
C;  the License, or (at your option) any later version.
C;
C;  This program is distributed in the hope that it will be useful,
C;  but WITHOUT ANY WARRANTY; without even the implied warranty of
C;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
C;  GNU General Public License for more details.
C;
C;  You should have received a copy of the GNU General Public
C;  License along with this program; if not, write to the Free
C;  Software Foundation, Inc., 675 Massachusetts Ave, Cambridge,
C;  MA 02139, USA.
C;
C;  Correspondence concerning AIPS should be addressed as follows:
C;         Internet email: aipsmail@nrao.edu.
C;         Postal address: AIPS Project Office
C;                         National Radio Astronomy Observatory
C;                         520 Edgemont Road
C;                         Charlottesville, VA 22903-2475 USA
C-----------------------------------------------------------------------
C-----------------------------------------------------------------------
C   Pseudo-AP version
C   Grids visibility data that has been loaded into the AP previously,
C   If requested, positions are shifted and then a taper is applied to
C   the weights if requested before gridding. Multiple frequency
C   channels may be gridded together for bandwidth synthesis.
C   Two work words are assumed before the first visibility.
C   Inputs:
C      UV    I  base address of u,v vector
C      VIS   I  base address of visibility
C      WT    I  base address of weights
C      L     I  length of visibility record
C      G     I  base address of grid
C      CX    I  BASE address of row convolving fn. (Y on sky)
C      CY    I  base address of col. convolving fn. (X on sky)
C               convolving fns tabulated every 1/100 cell
C      NT2   I  INT ( (no. cells used on a row)/2 )
C      M     I  number of rows kept in AP (MUST be odd)
C      LROW  I  length of a row (V)
C      CNT   I  number of visibility points.
C      NFREQ I  number of frequencies to grid.
C               If NFREQ is negative then tapering is requested.
C               If CNT is neg, do not shift data.
C   Expects necessary constants in following AP locations:
C           8 = -SIG(U)**2 (CELLS**2) for taper
C           9 = -SIG(V)**2 (CELLS**2) for taper
C          10 = U scaling to cells
C          11 = V scaling to cells
C          12 = W scaling to cells
C          13 = DXC = -2 * PI * delta RA (in 1/cells) for 1ST
C          14 = DYC = -2 * PI * delta DEC         frequency channel
C          15 = DZC = -2 * PI * delta Z
C          16...16+NFREQ-2 = differential frequency scaling table
C               for channels after the first one.
C               FREQ(n) = (1+MD(16+n-1)) * FREQ(n-1) for n>1
C-----------------------------------------------------------------------
      INTEGER   UV, VIS, WT, L, G, CX, CY, NT2, M, LROW, CNT, NFREQ,
     *   UV1, UV2,  FCNT, IWORK1, IWORK2, NOTAP, NOSHF, IFQ, WRK,
     *   VVIS, IFRQ, JNFREQ, JCNT,
     *   ONE, M8, M9, M10, M11, M12, M13, M14, M15
      DATA ONE, M8, M9, M10, M11, M12, M13, M14, M15
     *    / 1,   8,  9,  10,  11,  12,  13,  14,  15/
C-----------------------------------------------------------------------
C                                       Save variables to be changed
      JCNT = CNT
      JNFREQ = NFREQ
      VVIS = VIS
C                                       Set work variables
      UV1 = UV + 1
      UV2 = UV + 2
      FCNT = 0
      IWORK1 = VVIS - 2
      IWORK2 = IWORK1 + 1
C                                       Check if tapered
      NOTAP = JNFREQ
      IF (JNFREQ.LT.0) JNFREQ = - JNFREQ
C                                       Check shift
      NOSHF = JCNT
      IF (JCNT.EQ.0) GO TO 999
      IF (JCNT.LT.0) JCNT = -JCNT
C                                       Scale u,v,w to cells.
      CALL QVSMUL (UV, L, M10, UV, L, JCNT)
      CALL QVSMUL (UV1, L, M11, UV1, L, JCNT)
      CALL QVSMUL (UV2, L, M12, UV2, L, JCNT)
C                                       Taper
      IF (NOTAP.GT.0) GO TO 50
         CALL QVMUL (UV, L, UV, L, IWORK1, L, JCNT)
         CALL QVMUL (UV1, L, UV1, L, IWORK2, L, JCNT)
         CALL QVSMUL (IWORK1, L, M8, IWORK1, L, JCNT)
         CALL QVSMA (IWORK2, L, M9, IWORK1, L, IWORK1, L, JCNT)
         CALL QVEXP (IWORK1, L, IWORK1, L, JCNT)
         CALL QVMUL (WT, L, IWORK1, L, WT, L, JCNT)
C                                       Frequency looping, rescale uv
 50   DO 300 IFRQ = 1,JNFREQ
C                                       Don't rescale on first pass.
         IF (IFRQ.EQ.1) GO TO 110
            WRK = FCNT
            IFQ = WRK + 15
            CALL QVSMA (UV, L, IFQ, UV, L, UV, L, JCNT)
            CALL QVSMA (UV1, L, IFQ, UV1, L, UV1, L, JCNT)
            CALL QVSMA (UV2, L, IFQ, UV2, L, UV2, L, JCNT)
 110     FCNT = FCNT + 1
C                                       Shift position.
         IF (NOSHF.LT.0) GO TO 200
            CALL QVSMUL (UV, L, M13, IWORK1, L, JCNT)
            CALL QVSMA (UV1, L, M14, IWORK1, L, IWORK1, L, JCNT)
            CALL QVSMA (UV2, L, M15, IWORK1, L, IWORK1, L, JCNT)
            CALL QVSIN (IWORK1, L, IWORK2, L, JCNT)
            CALL QVCOS (IWORK1, L, IWORK1, L, JCNT)
            CALL QCVMUL (IWORK1, L, VVIS, L, VVIS, L, JCNT, ONE)
C                                       Grid
 200     CALL QGRD4 (UV, VVIS, WT, G, CX, CY, NT2, M, LROW, L, JCNT)
         VVIS = VVIS + 2
 300     CONTINUE
C
 999  RETURN
      END
