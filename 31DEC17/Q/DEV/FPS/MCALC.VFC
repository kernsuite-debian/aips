      DEFINE MCALC(NGS,NPT,NV)
"-----------------------------------------------------------------------
"! FPS VFC routine: Compute model visibilities
"# AP-appl UV Obselete
"-----------------------------------------------------------------------
";  Copyright (C) 1995
";  Associated Universities, Inc. Washington DC, USA.
";
";  This program is free software; you can redistribute it and/or
";  modify it under the terms of the GNU General Public License as
";  published by the Free Software Foundation; either version 2 of
";  the License, or (at your option) any later version.
";
";  This program is distributed in the hope that it will be useful,
";  but WITHOUT ANY WARRANTY; without even the implied warranty of
";  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
";  GNU General Public License for more details.
";
";  You should have received a copy of the GNU General Public
";  License along with this program; if not, write to the Free
";  Software Foundation, Inc., 675 Massachusetts Ave, Cambridge,
";  MA 02139, USA.
";
";  Correspondence concerning AIPS should be addressed as follows:
";         Internet email: aipsmail@nrao.edu.
";         Postal address: AIPS Project Office
";                         National Radio Astronomy Observatory
";                         520 Edgemont Road
";                         Charlottesville, VA 22903-2475 USA
"-----------------------------------------------------------------------
"-----------------------------------------------------------------------
"
"        MCALC is an array processor vector function chainer
"   subroutine that is called by the self-calibration programs
"   ASCAL and LSCAL.  It's purpose is to compute model visibili-
"   ties.
"
"   Input:
"      NGS -- number of Gaussian components (Gaussian components
"             are not supported at present, so only NGS=0 will
"             work properly)
"      NPT -- number of point components
"      NV  -- number of visibilities to compute
"
"   AP storage allocation:
"      first 7*NGS locations -- parameters of Gaussian compo-
"         nents
"      next 4*NPT locations -- parameters of point components.
"         The component parameter vectors (flux,x,y,z) are
"         assumed to have been stored one after another.  Fluxes
"         are to be in units of Janskys, and the position off-
"         sets from the visibility phase reference position are
"         to be in units of radians multiplied by 2 pi.
"      next location  --  number of visibility observations,
"         NOBS
"      next NOBS locations -- spatial frequency u-coordinates,
"         in units of wavelengths
"      next NOBS locations -- v-coordinates in wavelengths
"      next NOBS locations -- w-coordinates in wavelengths
"      next 2*NOBS locations -- MCALC stores its result, the
"         model visibilities, here
"      next 2*NOBS locations -- a work area
"
      LOCAL M1,M2,M3,M4,M5
      LOCAL IGS,IPT,INGS,INPT,INOBS,IU,IV,IW,IVMOD,IWK,I
      IGS=0
      M1=7*NGS
      IPT=IGS+M1
      M1=4*NPT
      INGS=IPT+M1
      INPT=INGS+1
      INOBS=INPT+1
      IU=INOBS+1
      IV=IU+NV
      IW=IV+NV
      IVMOD=IW+NV
      M1=NV+NV
      IWK=IVMOD+M1
      I=0
      M1=IPT+1
      M2=IPT+2
      M3=IPT+3
      M4=IWK+1
LOOP: I=I+1
      CALL VSMUL(M1,4,IU,IWK,2,NPT)
      CALL VSMA(M2,4,IV,IWK,2,IWK,2,NPT)
      CALL VSMA(M3,4,IW,IWK,2,IWK,2,NPT)
      CALL CVEXP(IWK,2,IWK,2,NPT)
      CALL CRVMUL(IWK,2,IPT,4,IWK,2,NPT)
      CALL SVE(IWK,2,IVMOD,NPT)
      M5=IVMOD+1
      CALL SVE(M4,2,M5,NPT)
      IU=IU+1
      IV=IV+1
      IW=IW+1
      IVMOD=IVMOD+2
      IF I<NV GOTO LOOP
      END
