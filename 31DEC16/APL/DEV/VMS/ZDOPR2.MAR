        .TITLE  ZDOPR2  (VOL, LUN, NCOPY, FN, ISIZE, BUF, IERR)
;----------------------------------------------------------------------
;-----------------------------------------------------------------------
;;  Copyright (C) 1995
;;  Associated Universities, Inc. Washington DC, USA.
;;
;;  This program is free software; you can redistribute it and/or
;;  modify it under the terms of the GNU General Public License as
;;  published by the Free Software Foundation; either version 2 of
;;  the License, or (at your option) any later version.
;;
;;  This program is distributed in the hope that it will be useful,
;;  but WITHOUT ANY WARRANTY; without even the implied warranty of
;;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;;  GNU General Public License for more details.
;;
;;  You should have received a copy of the GNU General Public
;;  License along with this program; if not, write to the Free
;;  Software Foundation, Inc., 675 Massachusetts Ave, Cambridge,
;;  MA 02139, USA.
;;
;;  Correspondence concerning AIPS should be addressed as follows:
;;         Internet email: aipsmail@nrao.edu.
;;         Postal address: AIPS Project Office
;;                         National Radio Astronomy Observatory
;;                         520 Edgemont Road
;;                         Charlottesville, VA 22903-2475 USA
;-----------------------------------------------------------------------
;  activate the plot "spooler" by writing the plot file name in
;  the mailbox associated with the logical name vlambx1. the complete
;  file name(as obtained by the $parse service) complete with
;  directory specification is sent to the mailbox. the $parse service
;  will use the default directory in effect since one is not specified.
;
;  this routine will accept only 4 character logical names, not
;  including the ':', such as db00:, db01:, etc. in the first
;  five characters of "filename". real device names such as
;  dba0: will not work. only one level of translation on the
;  logical name is performed
;
;    INPUTS:
;      VOL       Vol name (Not used in VAX)
;      LUN       Logical unit number (Not used in VAX)
;      NCOPY     Number of copies (Not implemented in this version).
;      FILENAME  Name of the plot file as generated by ZPHFIL.
;                24 characters maximum, padded on right with blanks.
;      ISIZE     I*2   Size of BUF in words
;    INPUT/Output:
;      BUF       I*2(*)  Scratch buffer
;    OUTPUT:
;      IERR      Error return code:
;                  0 - o.k.
;                  1 - channel assign error for plot file disk.
;                  2 - error in parsing the file name.
;                  3 - channel assign error for mailbox.
;                  4 - i/o error in write to mailbox.
;                  5 - logical device name translation error
;                  6 - translated logical name is improper.
;----------------------------------------------------------------------
                                        ;
                                        ; SYSTEM SYMBOL DEFINITIONS
                                        ;
        $IODEF
        $FIBDEF
        $RMSDEF
                                        ;
                                        ; ARGUMENT LIST OFFETS
                                        ;
FN=16
IERR=28
;
NAMLEN=24
                                        ;
        .PSECT  CODE,NOWRT
        .ENTRY  ZDOPR2,^M<R2,R3,R4,R5,R6,R7,R8>
                                        ;SET UP FAB FOR PARSE.
        $FAB_STORE      FAB=FABBLK,-
                        FAC=<GET,BIO,PUT,TRN>,-
                        SHR=<PUT,GET,UPD,UPI>,-
                        FOP=<NAM>,-
                        FNA=@FILNAM(AP),-
                        FNS=FLEN,-
                        NAM=NAMBLK
                                        ;PARSE FOR DIRECTORY...
;
        $PARSE  FAB=FABBLK
        BLBS    R0,ASSIGN                       ;BRANCH IF OK
        MOVW    #2,@IERR(AP)            ;IERR=2, BAD PARSE
        BRW     EXIT
ASSIGN:
        $ASSIGN_S       DEVNAM=LOGNAM,- ;ASSIGN A MAILBOX
                CHAN=MBXCHAN
        BLBS    R0,WRITE
        MOVW    #3,@IERR(AP)            ;IERR = 3
        BRW     EXIT
;
;                                       ;WRITE THE MAILBOX
WRITE:  MOVZBL  NAMBLK+NAM$B_ESL,R2     ;GET EXPANDED NAME LENGTH
        $QIOW_S FUNC=#IO$_WRITEVBLK!IO$M_NOW,-
                CHAN=MBXCHAN,-
                IOSB=STATUS,-
                P1=BUFFER,-
                P2=R2
;
        BLBS    R0,EXIT
        MOVW    #4,@IERR(AP)            ;IERR=4
                                        ;MOVE NAMBLK INFO TO FIB.
                                        ;
;
        BRW     EXIT
EXIT:
        $DASSGN_S       CHAN=MBXCHAN
        $DASSGN_S       CHAN=CHAN
        RET
                                                ;
        .PSECT  DATA,LONG
STATUS: .QUAD   0
FABBLK: $FAB
NAMBLK: $NAM    ESA=BUFFER,-
                ESS=44
FLEN:   .LONG   24
CHAN:   .BLKW   1
BUFDSC: .LONG   44
BUFADD: .LONG   BUFFER
BUFFER: .BLKW   44
LOGNAM: .ASCID  /VLAMBX1/
MBXCHAN:        .BLKW   1       ;MAILBOX CHANNEL
        .END
