      DEFINE MULCLN(COMP,FLDESC,ABEAM,BBEAM,NCOMP)
"-----------------------------------------------------------------------
"! FPS VFC routine: High level Clark CLEAN routine.
"# AP-appl
"-----------------------------------------------------------------------
";  Copyright (C) 1995
";  Associated Universities, Inc. Washington DC, USA.
";
";  This program is free software; you can redistribute it and/or
";  modify it under the terms of the GNU General Public License as
";  published by the Free Software Foundation; either version 2 of
";  the License, or (at your option) any later version.
";
";  This program is distributed in the hope that it will be useful,
";  but WITHOUT ANY WARRANTY; without even the implied warranty of
";  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
";  GNU General Public License for more details.
";
";  You should have received a copy of the GNU General Public
";  License along with this program; if not, write to the Free
";  Software Foundation, Inc., 675 Massachusetts Ave, Cambridge,
";  MA 02139, USA.
";
";  Correspondence concerning AIPS should be addressed as follows:
";         Internet email: aipsmail@nrao.edu.
";         Postal address: AIPS Project Office
";                         National Radio Astronomy Observatory
";                         520 Edgemont Road
";                         Charlottesville, VA 22903-2475 USA
"-----------------------------------------------------------------------
"-----------------------------------------------------------------------
      LOCAL AMAP, LMAP, FCOMP
"
"   MULCLN Calls B. Clark's CLNSUB routine multiple times to
"   accumulate a number of CLEAN components in one AP call.
"
"     Inputs:
"   COMP    Base address of component vector 4 words per comp.:
"            1 = component intensity.
"            2 = x location (cells)
"            3 = y location (cells)
"            4 = field number
"     NOTE: this vector is the output of this routine.
"   FLDESC  Field descriptor vector base address.
"           0 = Number of fields (REAL value)
"     for each field:
"           0 = Start address of residuals (REAL value) (AMAP)
"              (location,intensity), intensity=2**14*x + y
"           1 = Number of points in the map. (REAL value) (LMAP)
"           2 = Current max. flux density (this location is FCOMP)
"           3 = X position of current max.
"           4 = Y position of current max.
"           5 = CLEAN gain
"   ABEAM   Base address of the square (folded) beam patch.
"           The Y direction is most rapid variable:-BY<Y<BY,
"           X varies less rapidly, -1<X<BX
"   BBEAM   Beam description vector (BX,BY).
"           In the current CLNSUB BX must equal BY.
"   NCOMP   Number of components to CLEAN.
"-----------------------------------------------------------------------
"                                       Find maxima.
         CALL CLNMAX (FLDESC)
"                                       Loop
LOOP:    CALL CLNPKS (FLDESC, COMP)    "Get max. residual
"                        CLNPKS  GIVES: SPAD 4 = AMAP
"                                       SPAD 5 = LMAP
"                                       SPAD 6 = FCOMP
         AMAP = SP04
         LMAP = SP05
         FCOMP = SP06
         CALL CLNSUB (FCOMP, AMAP, LMAP, ABEAM, BBEAM)
"                                       Check if finished
         NCOMP = NCOMP - 1
         IF NCOMP<=0 GOTO S999
"                                       Update COMP
         COMP = COMP + 4
         GOTO LOOP
S999:    END
